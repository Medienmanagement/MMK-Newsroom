<?php

/**
 * @author      Patrick Kromeyer
 * @license     please view LICENSE file
 */

namespace Newsroom\Entity\Repository;

/**
 * EventRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class EventRepository extends CrudRepository
{
    public function fetchEntityByUrl($url)
    {
        $entity = $this->findOneByUrl($url);

        if (! $entity instanceof $this->_entityName)
        {
            throw new \Exception('instanceof ' . $this->_entityName . ' failed');
        }

        return $entity;
    }

    public function fetchEntities($limit = null, $offset = null)
    {
        $qb = $this->createQueryBuilder('e');
        $qb->orderBy('e.update', 'desc');

        if (!empty ($limit))
        {
            $qb->setMaxResults($limit);
        }

        if (!empty ($offset))
        {
            $qb->setFirstResult($offset);
        }

        return $qb->getQuery()->execute();
    }

    public function saveEntity(array $data)
    {
        $data['update'] = new \DateTime();

        return parent::saveEntity($data);
    }
}
